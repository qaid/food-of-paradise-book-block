!function(t,i,s){"use strict";var e,n,o=t.event;e=o.special.debouncedresize={setup:function(){t(this).on("resize",e.handler)},teardown:function(){t(this).off("resize",e.handler)},handler:function(t,i){var s=this,r=arguments,a=function(){t.type="debouncedresize",o.dispatch.apply(s,r)};n&&clearTimeout(n),i?a():n=setTimeout(a,e.threshold)},threshold:150};var r=t(i),a=i.Modernizr;t.BookBlock=function(i,s){this.$el=t(s),this._init(i)},t.BookBlock.defaults={speed:1e3,easing:"ease-in-out",shadows:!0,shadowSides:.2,shadowFlip:.1,perspective:1300,circular:!1,nextEl:"",prevEl:"",autoplay:!1,interval:3e3,keyboard:!0,onEndFlip:function(){return!1},onBeforeFlip:function(){return!1}},t.BookBlock.prototype={_init:function(i){this.options=t.extend(!0,{},t.BookBlock.defaults,i),this.$el.css("perspective",this.options.perspective),this.$items=this.$el.children(".bb-item"),this.itemsCount=this.$items.length,this.current=0,this.previous=-1,this.$current=this.$items.eq(this.current).show(),this.elWidth=this.$el.width();var s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};this.transEndEventName=s[a.prefixed("transition")]+".bookblock",this.support=a.csstransitions&&a.csstransforms3d,this._initEvents(),this.options.autoplay&&(this.options.circular=!0,this._startSlideshow())},_initEvents:function(){var i=this;""!==this.options.nextEl&&t(this.options.nextEl).on("click.bookblock",function(){return i._action("next"),!1}),""!==this.options.prevEl&&t(this.options.prevEl).on("click.bookblock",function(){return i._action("prev"),!1}),1==this.options.keyboard&&t(document).keydown(function(t){var s=t.keyCode||t.which,e={left:37,up:38,right:39,down:40};switch(s){case e.left:i._action("prev");break;case e.right:i._action("next")}}),r.on("debouncedresize",function(){i.elWidth=i.$el.width()})},_action:function(t,i){this._stopSlideshow(),this._navigate(t,i)},_navigate:function(t,i){return this.isAnimating?!1:(this.options.onBeforeFlip(this.current),this.isAnimating=!0,this.$current=this.$items.eq(this.current),i!==s?this.current=i:"next"===t?this.options.circular||this.current!==this.itemsCount-1?(this.previous=this.current,this.current=this.current<this.itemsCount-1?this.current+1:0):this.end=!0:"prev"===t&&(this.options.circular||0!==this.current?(this.previous=this.current,this.current=this.current>0?this.current-1:this.itemsCount-1):this.end=!0),this.$nextItem=!this.options.circular&&this.end?this.$current:this.$items.eq(this.current),this.support?this._layout(t):this._layoutNoSupport(t),void 0)},_layoutNoSupport:function(t){this.$items.hide(),this.$nextItem.show(),this.end=!1,this.isAnimating=!1;var i="next"===t&&this.current===this.itemsCount-1||"prev"===t&&0===this.current;this.options.onEndFlip(this.previous,this.current,i)},_layout:function(t){var i=this,s=this._addSide("left",t),e=this._addSide("middle",t),n=this._addSide("right",t),o=s.find("div.bb-overlay"),r=e.find("div.bb-flipoverlay:first"),a=e.find("div.bb-flipoverlay:last"),h=n.find("div.bb-overlay"),c=this.end?400:this.options.speed;if(this.$items.hide(),this.$el.prepend(s,e,n),e.css({transition:"all "+c+"ms "+this.options.easing}).on(this.transEndEventName,function(s){if("bb-page"===s.target.className){i.$el.children("div.bb-page").remove(),i.$nextItem.show(),i.end=!1,i.isAnimating=!1;var e="next"===t&&i.current===i.itemsCount-1||"prev"===t&&0===i.current;i.options.onEndFlip(i.previous,i.current,e)}}),"prev"===t&&e.css({transform:"rotateY(-180deg)"}),this.options.shadows&&!this.end){var d="next"===t?{transition:"opacity "+this.options.speed/2+"ms linear "+this.options.speed/2+"ms"}:{transition:"opacity "+this.options.speed/2+"ms linear",opacity:this.options.shadowSides},l="next"===t?{transition:"opacity "+this.options.speed/2+"ms linear"}:{transition:"opacity "+this.options.speed/2+"ms linear "+this.options.speed/2+"ms",opacity:this.options.shadowFlip},p="next"===t?{transition:"opacity "+this.options.speed/2+"ms linear "+this.options.speed/2+"ms",opacity:this.options.shadowFlip}:{transition:"opacity "+this.options.speed/2+"ms linear"},u="next"===t?{transition:"opacity "+this.options.speed/2+"ms linear",opacity:this.options.shadowSides}:{transition:"opacity "+this.options.speed/2+"ms linear "+this.options.speed/2+"ms"};r.css(l),a.css(p),o.css(d),h.css(u)}setTimeout(function(){var s="next"===t?"rotateY(-180deg)":"rotateY(0deg)";i.end&&(s="next"===t?"rotateY(-15deg)":"rotateY(-165deg)"),e.css({transform:s}),i.options.shadows&&!i.end&&(r.css({opacity:"next"===t?i.options.shadowFlip:0}),a.css({opacity:"next"===t?0:i.options.shadowFlip}),o.css({opacity:"next"===t?i.options.shadowSides:0}),h.css({opacity:"next"===t?0:i.options.shadowSides}))},30)},_addSide:function(i,s){var e;switch(i){case"left":e=t('<div class="bb-page"><div class="bb-back"><div class="bb-outer"><div class="bb-content" style="width:'+this.elWidth+'px"><div class="bb-inner">'+("next"===s?this.$current.html():this.$nextItem.html())+'</div></div><div class="bb-overlay"></div></div></div></div>').css("z-index",102);break;case"middle":e=t('<div class="bb-page"><div class="bb-front"><div class="bb-outer"><div class="bb-content" style="left:'+-this.elWidth/2+"px;width:"+this.elWidth+'px"><div class="bb-inner">'+("next"===s?this.$current.html():this.$nextItem.html())+'</div></div><div class="bb-flipoverlay"></div></div></div><div class="bb-back"><div class="bb-outer"><div class="bb-content" style="width:'+this.elWidth+'px"><div class="bb-inner">'+("next"===s?this.$nextItem.html():this.$current.html())+'</div></div><div class="bb-flipoverlay"></div></div></div></div>').css("z-index",103);break;case"right":e=t('<div class="bb-page"><div class="bb-front"><div class="bb-outer"><div class="bb-content" style="left:'+-this.elWidth/2+"px;width:"+this.elWidth+'px"><div class="bb-inner">'+("next"===s?this.$nextItem.html():this.$current.html())+'</div></div><div class="bb-overlay"></div></div></div></div>').css("z-index",101)}return e},_startSlideshow:function(){var t=this;this.slideshow=setTimeout(function(){t._navigate("next"),t.options.autoplay&&t._startSlideshow()},this.options.interval)},_stopSlideshow:function(){this.options.autoplay&&(clearTimeout(this.slideshow),this.options.autoplay=!1)},next:function(){this._action("next")},prev:function(){this._action("prev")},jump:function(t){return t-=1,t===this.current||t>=this.itemsCount||0>t?!1:(this._action(t>this.current?"next":"prev",t),void 0)},isActive:function(){return this.isAnimating},update:function(){var t=this.$items.eq(this.current);this.$items=this.$el.children(".bb-item"),this.itemsCount=this.$items.length,this.current=t.index()}};var h=function(t){i.console&&i.console.error(t)};t.fn.bookblock=function(i){var s=t.data(this,"bookblock");if("string"==typeof i){var e=Array.prototype.slice.call(arguments,1);this.each(function(){return s?t.isFunction(s[i])&&"_"!==i.charAt(0)?(s[i].apply(s,e),void 0):(h("no such method '"+i+"' for bookblock instance"),void 0):(h("cannot call methods on bookblock prior to initialization; attempted to call method '"+i+"'"),void 0)})}else this.each(function(){s?s._init():s=t.data(this,"bookblock",new t.BookBlock(i,this))});return s}}(jQuery,window);